syntax = "proto3";

package pb;

enum DiscountType {
  NONE = 0;           // 无
  REBATE = 1;         // 打折
  FULL_REDUCTION = 2; // 满减
  FREE = 3;           // 免单
}

enum PriceRuleType {
  Time = 0;
  Count = 1;
}

enum ElementType {
  Main = 0;
  Attach = 1;
}


// ---------------------- instance 相关 ----------------------
message Order {
  int64 id = 1;
  Desk desk = 2;
  Discount discount = 3;
}

message Desk{
  Space space = 1;
  int64 startTimestamp = 2;
  int64 endTimestamp = 3;
  repeated Good goods = 4;
  bool hadCheckOut = 5;
  Discount discount = 6;
}


message Space {
  string name = 1;
  int64 num = 2;
  double price = 3;
  PriceRuleType priceRuleType = 4;
}

message GoodClass {
  string name = 1;
  repeated Good goods = 2;
}

message Good{
  int64 id = 1;
  Element mainElement = 2;
  repeated Element attachElements = 3;
  repeated DiscountType selectableDiscountTypes = 4;
  bool hadCheckOut = 5;
  Discount discount = 6;
}

message Element {
  string name = 1;
  repeated SizeInfo sizeInfos = 2;
}

message SizeInfo {
  string size = 1;
  double price = 2;
  string  pictureStorePath = 3;
  bool isSelected = 4;
}

message Discount {
  DiscountType discountType = 1;
  repeated string parameters = 2;
}


// 添加货物
message AddGoodReq {
  Good good = 1;
  string className = 2;
}

message AddGoodRes {}

message AddGoodClassReq{
  GoodClass goodClass = 1;
}
message AddGoodClassRes{}

message AddDeskReq{
  Desk desk = 1;
}

message AddDeskRes{}


message OrderGoodReq{
  int64 deskID = 1;
  repeated Good goods = 2;
  string className = 3;
}

message OrderGoodRes{
  // 这里可以返回 goods, 这些goods 有 goodID
}

message OpenDeskReq{
  string spaceName = 1;
  int64 spaceNum = 2;
}

message OpenDeskRes{
  int64 deskID = 1;
}

message OrderReq{
  Order order = 1;
}
message OrderRes{
  int64 orderID = 1;
}

message CloseDeskReq{
  int64 deskID = 1;
}
message CloseDeskRes{
}




message GetAllGoodClassesReq{}
message GetAllGoodClassesRes{
  repeated GoodClass goodClasses = 1;
}


message GetDeskReq{
  int64 deskID = 1;
}

message GetDeskRes{
  Desk desk = 1;
}

message CheckOutReq {
  int64 deskID = 1;
}

message CheckOutRes{
  double expanse = 1;
}

service Mvp {
  rpc AddGoodClass(AddGoodClassReq) returns (AddGoodClassRes);  // 添加商品类
  rpc AddGood(AddGoodReq) returns (AddGoodRes);           // 添加货物

  rpc AddDesk(AddDeskReq) returns (AddDeskRes);           // 添加桌位
  rpc OrderGood(OrderGoodReq) returns (OrderGoodRes);     // 为某桌点单
  rpc OpenDesk(OpenDeskReq) returns(OpenDeskRes);         // 开桌
  rpc CloseDesk(CloseDeskReq) returns(CloseDeskRes);      // 退桌
  rpc GetDesk(GetDeskReq) returns(GetDeskRes);            // 获得某桌的信息 （如开桌时长、点单货物...）
  rpc CheckOut(CheckOutReq) returns(CheckOutRes);         // 某桌结账

  rpc GetAllGoodClasses(GetAllGoodClassesReq) returns (GetAllGoodClassesRes); // 获得所有商品类及其下的货物

}


